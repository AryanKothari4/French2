<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>French Conjugation Quiz</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

        :root {
            --correct-color: #27ae60;
            --incorrect-color: #e74c3c;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Poppins', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #ff9a56 0%, #ffad56 25%, #c94b4b 75%, #8b0000 100%);
            background-attachment: fixed;
            color: #fff;
            padding: 20px;
        }

        .quiz-container {
            width: 100%;
            max-width: 500px;
            padding: 40px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-align: center;
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        h1, h2 { font-weight: 600; }
        h1 { margin-bottom: 10px; }

        #progress-counter, .setup-description { margin-bottom: 30px; font-weight: 300; opacity: 0.8; }
        #question-prompt { font-size: 1.2rem; margin-bottom: 10px; font-weight: 300; }
        #question-element { font-size: 2.5rem; margin-bottom: 30px; min-height: 60px; line-height: 1.2; }

        .input-group { display: flex; gap: 10px; flex-direction: column; }
        #answer-input { width: 100%; }
        #answer-input, .form-group select { 
            padding: 15px; 
            font-size: 1rem; 
            border-radius: 8px; 
            border: 2px solid rgba(255, 255, 255, 0.7); 
            background: rgba(255, 255, 255, 0.9); 
            color: #333; 
            outline: none; 
            transition: all 0.2s ease; 
            font-family: 'Poppins', sans-serif; 
        }
        #answer-input::placeholder { color: rgba(51, 51, 51, 0.6); }
        #answer-input:focus, .form-group select:focus { 
            background: rgba(255, 255, 255, 0.95); 
            border-color: #fff; 
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
        }
        #answer-input:disabled { opacity: 0.6; cursor: not-allowed; }

        .accent-guide {
            font-size: 0.85rem;
            opacity: 0.8;
            margin: 10px 0;
            text-align: center;
            line-height: 1.4;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .form-group { margin-bottom: 30px; text-align: left; }
        .form-group label { margin-bottom: 5px; font-size: 0.9rem; opacity: 0.8; display: block; }
        .form-group select { width: 100%; }
        .form-group select option { background: #c94b4b; color: #fff; }

        button { 
            padding: 15px 25px; 
            font-size: 1rem; 
            font-weight: 600; 
            border: none; 
            border-radius: 8px; 
            background: #fff; 
            color: #c94b4b; 
            cursor: pointer; 
            transition: all 0.2s ease; 
            flex: 1;
        }
        button:hover { background: #f0f0f0; transform: translateY(-2px); }
        button:disabled { opacity: 0.5; cursor: not-allowed; transform: translateY(0); }

        #hint-button { 
            background: transparent; 
            border: 1px solid rgba(255, 255, 255, 0.6); 
            color: #fff; 
        }
        #hint-button:hover:not(:disabled) { background: rgba(255, 255, 255, 0.2); }

        #feedback-message { 
            min-height: 40px; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            margin-top: 20px; 
            font-weight: 600; 
        }
        .correct, .incorrect { 
            background-color: rgba(0, 0, 0, 0.6); 
            padding: 5px 15px; 
            border-radius: 8px; 
            animation: fadeIn 0.3s; 
        }
        .correct { color: var(--correct-color); }
        .incorrect { color: var(--incorrect-color); }
        .hint-message { font-size: 0.9rem; opacity: 0.8; font-weight: 400; }
        
        #continue-prompt { 
            display: none; 
            margin-top: 15px; 
            font-size: 0.9rem; 
            opacity: 0.7; 
            animation: fadeIn 0.5s; 
        }

        #quiz-box, #completion-screen { display: none; }
        #completion-screen { 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
        }
        #completion-screen h2 { font-size: 2.5rem; margin-bottom: 20px; }
        #final-score { font-size: 1.2rem; margin-bottom: 30px; }

        #review-section { width: 100%; margin-top: 20px; text-align: left; }
        #review-section h3 { text-align: center; margin-bottom: 15px; font-weight: 400; }
        #wrong-answers-list { 
            list-style-type: none; 
            max-height: 150px; 
            overflow-y: auto; 
            background: rgba(0,0,0,0.2); 
            padding: 15px; 
            border-radius: 8px; 
        }
        #wrong-answers-list li { padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.2); }
        #wrong-answers-list li:last-child { border-bottom: none; }

        @keyframes fadeIn { 
            from { opacity: 0; transform: scale(0.9); } 
            to { opacity: 1; transform: scale(1); } 
        }
    </style>
</head>
<body>
    <div class="quiz-container" id="selection-container">
        <h1>French Conjugation Quiz</h1>
        <p class="setup-description">Choose a conjugation type to practice.</p>
        <form id="start-quiz-form">
            <div class="form-group">
                <label for="tense-select">Choose Conjugation Type</label>
                <select id="tense-select">
                    <option value="present">Present Tense</option>
                    <option value="passe-compose">Passé Composé</option>
                    <option value="imparfait">Imparfait</option>
                </select>
            </div>
            <button type="submit">Start Quiz</button>
        </form>
    </div>

    <div class="quiz-container" id="quiz-box">
        <h1>French Conjugation Quiz</h1>
        <p id="progress-counter"></p>
        <div id="question-area">
            <p id="question-prompt">Conjugate the verb:</p>
            <h2 id="question-element"></h2>
        </div>
        <form id="answer-form">
            <div class="input-group">
                <input type="text" id="answer-input" placeholder="Type your conjugation..." autocomplete="off" autofocus>
                <!-- UPDATED: Sequential accent guide (1 through 7) -->
                <div class="accent-guide">
                    Accents: 1→à  2→é  3→è  4→ê  5→î  6→ô  7→ç
                </div>
                <div class="button-group">
                    <button type="button" id="hint-button">Hint</button>
                    <button type="submit" id="check-button">Check</button>
                </div>
            </div>
        </form>
        <div id="feedback-message"></div>
        <p id="continue-prompt">Press Enter or click Continue</p>
    </div>

    <div class="quiz-container" id="completion-screen">
        <h2>Quiz Complete!</h2>
        <p id="final-score"></p>
        <div id="review-section" style="display: none;">
            <h3>Conjugations to Review:</h3>
            <ul id="wrong-answers-list"></ul>
        </div>
        <button id="restart-button">Quiz Again</button>
    </div>

    <script>
        // French verb conjugation data
        const verbData = {
            'present': {
                verbs: ['chanter', 'jouer', 'manger', 'commencer', 'envoyer', 's\'appeler', 'acheter', 'préférer', 'finir', 'vendre', 'aller', 'avoir', 'être', 'faire', 'venir', 'tenir', 'mettre', 'prendre', 'savoir', 'connaître', 'dire', 'écrire', 'lire', 'devoir', 'pouvoir', 'vouloir', 'dormir', 'partir', 'sortir', 'voir'],
                questionsPerVerb: 6 // all subjects
            },
            'passe-compose': {
                verbs: ['regarder', 'finir', 'vendre', 'être', 'vouloir', 'pouvoir', 'avoir', 'prendre', 'devoir', 'faire', 'mettre', 'descendre', 'retourner', 'monter', 'rester', 'sortir', 'venir', 'aller', 'naître', 'devenir', 'entrer', 'revenir', 'tomber', 'rentrer', 'arriver', 'mourir', 'partir', 'passer', 'nager', 'étudier', 'servir', 'dire', 'payer', 'voir', 'croire', 'écrire', 'lire'],
                questionsPerVerb: 2
            },
            'imparfait': {
                verbs: ['jouer', 'finir', 'grossir', 'être', 'attendre', 'vendre', 'étudier', 'chercher', 'nager', 'bouger', 'placer', 'faire', 'venir', 'dormir', 'mettre', 'voir', 'boire', 'sortir', 'vouloir', 'choisir', 'commencer'],
                questionsPerVerb: 2
            }
        };

        // Fixed subject pronouns - separate for selection and conjugation
        const subjects = ['je', 'tu', 'il', 'elle', 'on', 'nous', 'vous', 'ils', 'elles'];
        const subjectGroups = [
            ['je'], ['tu'], ['il', 'elle', 'on'],
            ['nous'], ['vous'], ['ils', 'elles']
        ];

        // Conjugation functions (minimized for brevity)
        function conjugatePresent(verb, subject) {
            const conjugations = {
                'chanter': { 'je': 'chante', 'tu': 'chantes', 'il': 'chante', 'elle': 'chante', 'on': 'chante', 'nous': 'chantons', 'vous': 'chantez', 'ils': 'chantent', 'elles': 'chantent' },'jouer': { 'je': 'joue', 'tu': 'joues', 'il': 'joue', 'elle': 'joue', 'on': 'joue', 'nous': 'jouons', 'vous': 'jouez', 'ils': 'jouent', 'elles': 'jouent' },'manger': { 'je': 'mange', 'tu': 'manges', 'il': 'mange', 'elle': 'mange', 'on': 'mange', 'nous': 'mangeons', 'vous': 'mangez', 'ils': 'mangent', 'elles': 'mangent' },'commencer': { 'je': 'commence', 'tu': 'commences', 'il': 'commence', 'elle': 'commence', 'on': 'commence', 'nous': 'commençons', 'vous': 'commencez', 'ils': 'commencent', 'elles': 'commencent' },'envoyer': { 'je': 'envoie', 'tu': 'envoies', 'il': 'envoie', 'elle': 'envoie', 'on': 'envoie', 'nous': 'envoyons', 'vous': 'envoyez', 'ils': 'envoient', 'elles': 'envoient' },'s\'appeler': { 'je': 'm\'appelle', 'tu': 't\'appelles', 'il': 's\'appelle', 'elle': 's\'appelle', 'on': 's\'appelle', 'nous': 'nous appelons', 'vous': 'vous appelez', 'ils': 's\'appellent', 'elles': 's\'appellent' },'acheter': { 'je': 'achète', 'tu': 'achètes', 'il': 'achète', 'elle': 'achète', 'on': 'achète', 'nous': 'achetons', 'vous': 'achetez', 'ils': 'achètent', 'elles': 'achètent' },'préférer': { 'je': 'préfère', 'tu': 'préfères', 'il': 'préfère', 'elle': 'préfère', 'on': 'préfère', 'nous': 'préférons', 'vous': 'préférez', 'ils': 'préfèrent', 'elles': 'préfèrent' },'finir': { 'je': 'finis', 'tu': 'finis', 'il': 'finit', 'elle': 'finit', 'on': 'finit', 'nous': 'finissons', 'vous': 'finissez', 'ils': 'finissent', 'elles': 'finissent' },'vendre': { 'je': 'vends', 'tu': 'vends', 'il': 'vend', 'elle': 'vend', 'on': 'vend', 'nous': 'vendons', 'vous': 'vendez', 'ils': 'vendent', 'elles': 'vendent' },'aller': { 'je': 'vais', 'tu': 'vas', 'il': 'va', 'elle': 'va', 'on': 'va', 'nous': 'allons', 'vous': 'allez', 'ils': 'vont', 'elles': 'vont' },'avoir': { 'je': 'ai', 'tu': 'as', 'il': 'a', 'elle': 'a', 'on': 'a', 'nous': 'avons', 'vous': 'avez', 'ils': 'ont', 'elles': 'ont' },'être': { 'je': 'suis', 'tu': 'es', 'il': 'est', 'elle': 'est', 'on': 'est', 'nous': 'sommes', 'vous': 'êtes', 'ils': 'sont', 'elles': 'sont' },'faire': { 'je': 'fais', 'tu': 'fais', 'il': 'fait', 'elle': 'fait', 'on': 'fait', 'nous': 'faisons', 'vous': 'faites', 'ils': 'font', 'elles': 'font' },'venir': { 'je': 'viens', 'tu': 'viens', 'il': 'vient', 'elle': 'vient', 'on': 'vient', 'nous': 'venons', 'vous': 'venez', 'ils': 'viennent', 'elles': 'viennent' },'tenir': { 'je': 'tiens', 'tu': 'tiens', 'il': 'tient', 'elle': 'tient', 'on': 'tient', 'nous': 'tenons', 'vous': 'tenez', 'ils': 'tiennent', 'elles': 'tiennent' },'mettre': { 'je': 'mets', 'tu': 'mets', 'il': 'met', 'elle': 'met', 'on': 'met', 'nous': 'mettons', 'vous': 'mettez', 'ils': 'mettent', 'elles': 'mettent' },'prendre': { 'je': 'prends', 'tu': 'prends', 'il': 'prend', 'elle': 'prend', 'on': 'prend', 'nous': 'prenons', 'vous': 'prenez', 'ils': 'prennent', 'elles': 'prennent' },'savoir': { 'je': 'sais', 'tu': 'sais', 'il': 'sait', 'elle': 'sait', 'on': 'sait', 'nous': 'savons', 'vous': 'savez', 'ils': 'savent', 'elles': 'savent' },'connaître': { 'je': 'connais', 'tu': 'connais', 'il': 'connaît', 'elle': 'connaît', 'on': 'connaît', 'nous': 'connaissons', 'vous': 'connaissez', 'ils': 'connaissent', 'elles': 'connaissent' },'dire': { 'je': 'dis', 'tu': 'dis', 'il': 'dit', 'elle': 'dit', 'on': 'dit', 'nous': 'disons', 'vous': 'dites', 'ils': 'disent', 'elles': 'disent' },'écrire': { 'je': 'écris', 'tu': 'écris', 'il': 'écrit', 'elle': 'écrit', 'on': 'écrit', 'nous': 'écrivons', 'vous': 'écrivez', 'ils': 'écrivent', 'elles': 'écrivent' },'lire': { 'je': 'lis', 'tu': 'lis', 'il': 'lit', 'elle': 'lit', 'on': 'lit', 'nous': 'lisons', 'vous': 'lisez', 'ils': 'lisent', 'elles': 'lisent' },'devoir': { 'je': 'dois', 'tu': 'dois', 'il': 'doit', 'elle': 'doit', 'on': 'doit', 'nous': 'devons', 'vous': 'devez', 'ils': 'doivent', 'elles': 'doivent' },'pouvoir': { 'je': 'peux', 'tu': 'peux', 'il': 'peut', 'elle': 'peut', 'on': 'peut', 'nous': 'pouvons', 'vous': 'pouvez', 'ils': 'peuvent', 'elles': 'peuvent' },'vouloir': { 'je': 'veux', 'tu': 'veux', 'il': 'veut', 'elle': 'veut', 'on': 'veut', 'nous': 'voulons', 'vous': 'voulez', 'ils': 'veulent', 'elles': 'veulent' },'dormir': { 'je': 'dors', 'tu': 'dors', 'il': 'dort', 'elle': 'dort', 'on': 'dort', 'nous': 'dormons', 'vous': 'dormez', 'ils': 'dorment', 'elles': 'dorment' },'partir': { 'je': 'pars', 'tu': 'pars', 'il': 'part', 'elle': 'part', 'on': 'part', 'nous': 'partons', 'vous': 'partez', 'ils': 'partent', 'elles': 'partent' },'sortir': { 'je': 'sors', 'tu': 'sors', 'il': 'sort', 'elle': 'sort', 'on': 'sort', 'nous': 'sortons', 'vous': 'sortez', 'ils': 'sortent', 'elles': 'sortent' },'voir': { 'je': 'vois', 'tu': 'vois', 'il': 'voit', 'elle': 'voit', 'on': 'voit', 'nous': 'voyons', 'vous': 'voyez', 'ils': 'voient', 'elles': 'voient' }
            };
            return conjugations[verb] ? conjugations[verb][subject] : '';
        }
        function conjugatePasseCompose(verb, subject) {
            const etreVerbs = ['aller', 'venir', 'arriver', 'partir', 'sortir', 'entrer', 'rentrer', 'retourner', 'tomber', 'rester', 'monter', 'descendre', 'naître', 'mourir', 'devenir', 'revenir'];
            const pastParticiples = { 'regarder': 'regardé', 'finir': 'fini', 'vendre': 'vendu', 'être': 'été', 'vouloir': 'voulu', 'pouvoir': 'pu', 'avoir': 'eu', 'prendre': 'pris', 'devoir': 'dû', 'faire': 'fait', 'mettre': 'mis', 'descendre': 'descendu', 'retourner': 'retourné', 'monter': 'monté', 'rester': 'resté', 'sortir': 'sorti', 'venir': 'venu', 'aller': 'allé', 'naître': 'né', 'devenir': 'devenu', 'entrer': 'entré', 'revenir': 'revenu', 'tomber': 'tombé', 'rentrer': 'rentré', 'arriver': 'arrivé', 'mourir': 'mort', 'partir': 'parti', 'passer': 'passé', 'nager': 'nagé', 'étudier': 'étudié', 'servir': 'servi', 'dire': 'dit', 'payer': 'payé', 'voir': 'vu', 'croire': 'cru', 'écrire': 'écrit', 'lire': 'lu' };
            const avoirConjugations = { 'je': 'ai', 'tu': 'as', 'il': 'a', 'elle': 'a', 'on': 'a', 'nous': 'avons', 'vous': 'avez', 'ils': 'ont', 'elles': 'ont' };
            const etreConjugations = { 'je': 'suis', 'tu': 'es', 'il': 'est', 'elle': 'est', 'on': 'est', 'nous': 'sommes', 'vous': 'êtes', 'ils': 'sont', 'elles': 'sont' };
            const pastParticiple = pastParticiples[verb];
            if (!pastParticiple) return '';
            return etreVerbs.includes(verb) ? `${etreConjugations[subject]} ${pastParticiple}` : `${avoirConjugations[subject]} ${pastParticiple}`;
        }
        function conjugateImparfait(verb, subject) {
            const conjugations = {
                'jouer': { 'je': 'jouais', 'tu': 'jouais', 'il': 'jouait', 'elle': 'jouait', 'on': 'jouait', 'nous': 'jouions', 'vous': 'jouiez', 'ils': 'jouaient', 'elles': 'jouaient' }, 'finir': { 'je': 'finissais', 'tu': 'finissais', 'il': 'finissait', 'elle': 'finissait', 'on': 'finissait', 'nous': 'finissions', 'vous': 'finissiez', 'ils': 'finissaient', 'elles': 'finissaient' }, 'grossir': { 'je': 'grossissais', 'tu': 'grossissais', 'il': 'grossissait', 'elle': 'grossissait', 'on': 'grossissait', 'nous': 'grossissions', 'vous': 'grossissiez', 'ils': 'grossissaient', 'elles': 'grossissaient' }, 'être': { 'je': 'étais', 'tu': 'étais', 'il': 'était', 'elle': 'était', 'on': 'était', 'nous': 'étions', 'vous': 'étiez', 'ils': 'étaient', 'elles': 'étaient' }, 'attendre': { 'je': 'attendais', 'tu': 'attendais', 'il': 'attendait', 'elle': 'attendait', 'on': 'attendait', 'nous': 'attendions', 'vous': 'attendiez', 'ils': 'attendaient', 'elles': 'attendaient' }, 'vendre': { 'je': 'vendais', 'tu': 'vendais', 'il': 'vendait', 'elle': 'vendait', 'on': 'vendait', 'nous': 'vendions', 'vous': 'vendiez', 'ils': 'vendaient', 'elles': 'vendaient' }, 'étudier': { 'je': 'étudiais', 'tu': 'étudiais', 'il': 'étudiait', 'elle': 'étudiait', 'on': 'étudiait', 'nous': 'étudiions', 'vous': 'étudiiez', 'ils': 'étudiaient', 'elles': 'étudiaient' }, 'chercher': { 'je': 'cherchais', 'tu': 'cherchais', 'il': 'cherchait', 'elle': 'cherchait', 'on': 'cherchait', 'nous': 'cherchions', 'vous': 'cherchiez', 'ils': 'cherchaient', 'elles': 'cherchaient' }, 'nager': { 'je': 'nageais', 'tu': 'nageais', 'il': 'nageait', 'elle': 'nageait', 'on': 'nageait', 'nous': 'nagions', 'vous': 'nagiez', 'ils': 'nageaient', 'elles': 'nageaient' }, 'bouger': { 'je': 'bougeais', 'tu': 'bougeais', 'il': 'bougeait', 'elle': 'bougeait', 'on': 'bougeait', 'nous': 'bougions', 'vous': 'bougiez', 'ils': 'bougeaient', 'elles': 'bougeaient' }, 'placer': { 'je': 'plaçais', 'tu': 'plaçais', 'il': 'plaçait', 'elle': 'plaçait', 'on': 'plaçait', 'nous': 'placions', 'vous': 'placiez', 'ils': 'plaçaient', 'elles': 'plaçaient' }, 'faire': { 'je': 'faisais', 'tu': 'faisais', 'il': 'faisait', 'elle': 'faisait', 'on': 'faisait', 'nous': 'faisions', 'vous': 'faisiez', 'ils': 'faisaient', 'elles': 'faisaient' }, 'venir': { 'je': 'venais', 'tu': 'venais', 'il': 'venait', 'elle': 'venait', 'on': 'venait', 'nous': 'venions', 'vous': 'veniez', 'ils': 'venaient', 'elles': 'venaient' }, 'dormir': { 'je': 'dormais', 'tu': 'dormais', 'il': 'dormait', 'elle': 'dormait', 'on': 'dormait', 'nous': 'dormions', 'vous': 'dormiez', 'ils': 'dorment', 'elles': 'dorment' }, 'mettre': { 'je': 'mettais', 'tu': 'mettais', 'il': 'mettait', 'elle': 'mettait', 'on': 'mettait', 'nous': 'mettions', 'vous': 'mettiez', 'ils': 'mettaient', 'elles': 'mettaient' }, 'voir': { 'je': 'voyais', 'tu': 'voyais', 'il': 'voyait', 'elle': 'voyait', 'on': 'voyait', 'nous': 'voyions', 'vous': 'voyiez', 'ils': 'voyaient', 'elles': 'voyaient' }, 'boire': { 'je': 'buvais', 'tu': 'buvais', 'il': 'buvait', 'elle': 'buvait', 'on': 'buvait', 'nous': 'buvions', 'vous': 'buviez', 'ils': 'buvaient', 'elles': 'buvaient' }, 'sortir': { 'je': 'sortais', 'tu': 'sortais', 'il': 'sortait', 'elle': 'sortait', 'on': 'sortait', 'nous': 'sortions', 'vous': 'sortiez', 'ils': 'sortaient', 'elles': 'sortaient' }, 'vouloir': { 'je': 'voulais', 'tu': 'voulais', 'il': 'voulait', 'elle': 'voulait', 'on': 'voulait', 'nous': 'voulions', 'vous': 'vouliez', 'ils': 'voulaient', 'elles': 'voulaient' }, 'choisir': { 'je': 'choisissais', 'tu': 'choisissais', 'il': 'choisissait', 'elle': 'choisissait', 'on': 'choisissait', 'nous': 'choisissions', 'vous': 'choisissiez', 'ils': 'choisissaient', 'elles': 'choisissaient' }, 'commencer': { 'je': 'commençais', 'tu': 'commençais', 'il': 'commençait', 'elle': 'commençait', 'on': 'commençait', 'nous': 'commencions', 'vous': 'commenciez', 'ils': 'commençaient', 'elles': 'commençaient' }
            };
            return conjugations[verb] ? conjugations[verb][subject] : '';
        }
        function getCorrectConjugation(verb, subject, tense) {
            switch (tense) {
                case 'present': return conjugatePresent(verb, subject);
                case 'passe-compose': return conjugatePasseCompose(verb, subject);
                case 'imparfait': return conjugateImparfait(verb, subject);
                default: return '';
            }
        }

        // DOM elements
        const selectionContainer = document.getElementById('selection-container');
        const startQuizForm = document.getElementById('start-quiz-form');
        const tenseSelect = document.getElementById('tense-select');
        const quizBox = document.getElementById('quiz-box');
        const completionScreen = document.getElementById('completion-screen');
        const progressCounter = document.getElementById('progress-counter');
        const questionElement = document.getElementById('question-element');
        const answerForm = document.getElementById('answer-form');
        const answerInput = document.getElementById('answer-input');
        const checkButton = document.getElementById('check-button');
        const hintButton = document.getElementById('hint-button');
        const feedbackMessage = document.getElementById('feedback-message');
        const continuePrompt = document.getElementById('continue-prompt');
        const restartButton = document.getElementById('restart-button');
        const finalScore = document.getElementById('final-score');
        const reviewSection = document.getElementById('review-section');
        const wrongAnswersList = document.getElementById('wrong-answers-list');

        let currentTense = 'present';
        let quizQuestions = [];
        let currentQuestion = null;
        let currentQuestionIndex = 0;
        let isWaitingForContinue = false;
        let wronglyAnswered = [];
        let initialQuestionCount = 0;
        let questionsAnsweredCorrectly = 0;

        // UPDATED: Sequential accent map (1 through 7)
        const accentMap = {
            '1': 'à', '2': 'é', '3': 'è', '4': 'ê',
            '5': 'î', '6': 'ô', '7': 'ç'
        };

        answerInput.addEventListener('keydown', function(event) {
            if (accentMap[event.key]) {
                event.preventDefault();
                const cursorPos = this.selectionStart;
                this.value = this.value.slice(0, cursorPos) + accentMap[event.key] + this.value.slice(cursorPos);
                this.selectionStart = this.selectionEnd = cursorPos + 1;
            }
        });

        function generateQuestions(tense) {
            const data = verbData[tense];
            const questions = [];
            data.verbs.forEach(verb => {
                if (tense === 'present') {
                    subjectGroups.forEach(group => {
                        const randomSubject = group[Math.floor(Math.random() * group.length)];
                        questions.push({ verb, subject: randomSubject });
                    });
                } else {
                    const usedGroups = new Set();
                    for (let i = 0; i < data.questionsPerVerb; i++) {
                        let randomGroupIndex;
                        do { randomGroupIndex = Math.floor(Math.random() * subjectGroups.length); } while (usedGroups.has(randomGroupIndex));
                        usedGroups.add(randomGroupIndex);
                        const selectedGroup = subjectGroups[randomGroupIndex];
                        const randomSubject = selectedGroup[Math.floor(Math.random() * selectedGroup.length)];
                        questions.push({ verb, subject: randomSubject });
                    }
                }
            });
            return questions;
        }

        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function startGame(tense) {
            currentTense = tense;
            quizQuestions = shuffleArray(generateQuestions(tense));
            currentQuestionIndex = 0;
            wronglyAnswered = [];
            initialQuestionCount = quizQuestions.length;
            questionsAnsweredCorrectly = 0;
            selectionContainer.style.display = 'none';
            completionScreen.style.display = 'none';
            quizBox.style.display = 'block';
            nextQuestion();
        }

        function nextQuestion() {
            if (questionsAnsweredCorrectly >= initialQuestionCount) {
                endGame();
                return;
            }
            isWaitingForContinue = false;
            feedbackMessage.innerHTML = '';
            continuePrompt.style.display = 'none';
            checkButton.textContent = 'Check';
            answerInput.disabled = false;
            hintButton.disabled = false;
            answerInput.value = '';
            
            // Progress counter uses questionsAnsweredCorrectly to stay static on incorrect answers
            progressCounter.textContent = `Question ${questionsAnsweredCorrectly + 1} of ${initialQuestionCount}`;
            
            currentQuestion = quizQuestions[currentQuestionIndex];
            questionElement.textContent = `${currentQuestion.subject} ${currentQuestion.verb}`;
            answerInput.focus();
        }

        function checkAnswer(event) {
            event.preventDefault();
            if (isWaitingForContinue) {
                continueToNext();
                return;
            }
            const userAnswer = answerInput.value.trim().toLowerCase();
            if (!userAnswer) return;
            const correctAnswer = getCorrectConjugation(currentQuestion.verb, currentQuestion.subject, currentTense);
            const isCorrect = userAnswer === correctAnswer.toLowerCase();
            if (isCorrect) {
                questionsAnsweredCorrectly++;
                feedbackMessage.innerHTML = `<span class="correct">Correct!</span>`;
                answerInput.disabled = true;
                hintButton.disabled = true;
                setTimeout(continueToNext, 600);
            } else {
                // FAILED: Push question to the end for re-quiz
                quizQuestions.push(quizQuestions[currentQuestionIndex]);
                
                feedbackMessage.innerHTML = `<span class="incorrect">Incorrect. The answer is: ${correctAnswer}</span>`;
                
                // Add to review list only on the first time it's answered incorrectly
                if (!wronglyAnswered.some(item => item.verb === currentQuestion.verb && item.subject === currentQuestion.subject)) {
                    wronglyAnswered.push({ verb: currentQuestion.verb, subject: currentQuestion.subject, correctAnswer: correctAnswer, userAnswer: userAnswer });
                }

                isWaitingForContinue = true;
                answerInput.disabled = true;
                hintButton.disabled = true;
                checkButton.textContent = 'Continue';
                continuePrompt.style.display = 'block';
                checkButton.focus();
            }
        }

        function continueToNext() {
            currentQuestionIndex++;
            nextQuestion();
        }

        function showHint() {
            if (currentQuestion && !isWaitingForContinue) {
                const correctAnswer = getCorrectConjugation(currentQuestion.verb, currentQuestion.subject, currentTense);
                if (correctAnswer) {
                    const hint = correctAnswer.substring(0, Math.min(2, correctAnswer.length));
                    feedbackMessage.innerHTML = `<span class="hint-message">Hint: Starts with "${hint}..."</span>`;
                    hintButton.disabled = true;
                    answerInput.focus();
                }
            }
        }

        function endGame() {
            quizBox.style.display = 'none';
            if (wronglyAnswered.length === 0) {
                finalScore.textContent = `Perfect score! You got all ${initialQuestionCount} questions correct.`;
                reviewSection.style.display = 'none';
            } else {
                const correctCount = initialQuestionCount - wronglyAnswered.length;
                const percentage = Math.round((correctCount / initialQuestionCount) * 100);
                finalScore.textContent = `You correctly answered ${correctCount}/${initialQuestionCount} (${percentage}%) unique questions.`;
                wrongAnswersList.innerHTML = '';
                wronglyAnswered.forEach(item => {
                    const li = document.createElement('li');
                    li.textContent = `${item.subject} ${item.verb} → ${item.correctAnswer}`;
                    wrongAnswersList.appendChild(li);
                });
                reviewSection.style.display = 'block';
            }
            completionScreen.style.display = 'flex';
        }

        function resetToSelection() {
            completionScreen.style.display = 'none';
            selectionContainer.style.display = 'block';
        }

        // Event listeners
        startQuizForm.addEventListener('submit', function(event) {
            event.preventDefault();
            startGame(tenseSelect.value);
        });
        answerForm.addEventListener('submit', checkAnswer);
        hintButton.addEventListener('click', showHint);
        restartButton.addEventListener('click', resetToSelection);
    </script>
</body>
</html>